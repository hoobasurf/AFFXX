<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscription</title>
  <style>
    /* Styles existants + ajout pour preview photos */
    #previewPhotos {
      display: flex;
      flex-wrap: nowrap;       /* PAS de retour à la ligne */
      gap: 10px;
      margin-top: 10px;
      overflow-x: auto;
      padding-bottom: 10px;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      max-width: 100%;
      border-bottom: 2px solid #ff6dfb;
      user-select: none;
    }
    .photo-thumb {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 8px #ff6dfb;
      cursor: default;
      flex-shrink: 0;
      transition: transform 0.3s ease;
    }
    .photo-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .photo-thumb .remove-btn {
      position: absolute;
      top: 2px;
      right: 2px;
      background: rgba(255, 109, 251, 0.85);
      color: #000;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-weight: bold;
      font-size: 16px;
      line-height: 18px;
      text-align: center;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 0 4px #ff6dfb;
    }
    /* Zoom de la photo au centre */
    .photo-thumb.center {
      transform: scale(1.2);
      box-shadow: 0 0 15px #ff6dfb;
      z-index: 10;
    }
  </style>
</head>
<body>
  <h1>Inscription</h1>

  <form id="inscriptionForm" action="#" method="post" enctype="multipart/form-data">
    <!-- Champs d'inscription classiques (nom, email, etc.) -->
    <label for="nom">Nom :</label><br />
    <input type="text" id="nom" name="nom" required /><br /><br />

    <label for="email">Email :</label><br />
    <input type="email" id="email" name="email" required /><br /><br />

    <!-- Input photo -->
    <label for="photoInput">Choisissez vos photos (JPG uniquement, max 5) :</label><br />
    <input
      type="file"
      id="photoInput"
      name="photos"
      accept=".jpg,.jpeg"
      multiple
    /><br />

    <div id="previewPhotos"></div><br />

    <button type="submit">Valider</button>
  </form>

  <script>
    const photoInput = document.getElementById('photoInput');
    const previewPhotos = document.getElementById('previewPhotos');
    let selectedFiles = [];

    function updateCenterPhoto() {
      const container = previewPhotos;
      const photos = container.querySelectorAll('.photo-thumb');
      const containerRect = container.getBoundingClientRect();
      const containerCenter = containerRect.left + containerRect.width / 2;

      let closestPhoto = null;
      let closestDistance = Infinity;

      photos.forEach(photo => {
        const rect = photo.getBoundingClientRect();
        const photoCenter = rect.left + rect.width / 2;
        const distance = Math.abs(containerCenter - photoCenter);

        if (distance < closestDistance) {
          closestDistance = distance;
          closestPhoto = photo;
        }

        photo.classList.remove('center');
      });

      if (closestPhoto) {
        closestPhoto.classList.add('center');
      }
    }

    function updatePreview() {
      previewPhotos.innerHTML = '';
      selectedFiles.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function (e) {
          const div = document.createElement('div');
          div.classList.add('photo-thumb');

          const img = document.createElement('img');
          img.src = e.target.result;
          img.alt = file.name;

          const removeBtn = document.createElement('span');
          removeBtn.classList.add('remove-btn');
          removeBtn.textContent = '×';
          removeBtn.title = 'Supprimer cette photo';
          removeBtn.addEventListener('click', () => {
            selectedFiles.splice(index, 1);
            updatePreview();
            updateCenterPhoto();
          });

          div.appendChild(img);
          div.appendChild(removeBtn);
          previewPhotos.appendChild(div);

          if (index === selectedFiles.length - 1) {
            updateCenterPhoto();
          }
        };
        reader.readAsDataURL(file);
      });
    }

    photoInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files);

      if (selectedFiles.length + files.length > 5) {
        alert('Vous pouvez sélectionner jusqu’à 5 photos maximum.');
        return;
      }

      const jpgFiles = files.filter(
        (f) => f.type === 'image/jpeg' || f.type === 'image/jpg'
      );
      if (jpgFiles.length !== files.length) {
        alert('Seules les photos JPG/JPEG sont acceptées.');
      }

      selectedFiles = selectedFiles.concat(jpgFiles);
      updatePreview();

      // Reset input pour pouvoir re-sélectionner les mêmes fichiers si besoin
      photoInput.value = '';
    });

    previewPhotos.addEventListener('scroll', () => {
      updateCenterPhoto();
    });

    const form = document.getElementById('inscriptionForm');
    form.addEventListener('submit', (e) => {
      if (selectedFiles.length === 0) {
        e.preventDefault();
        alert('Veuillez sélectionner au moins une photo JPG.');
      } else {
        // TODO: gérer l'upload réel côté serveur/Firebase
        alert(
          `Prêt à envoyer ${selectedFiles.length} photo(s). (Upload à implémenter)`
        );
      }
    });
  </script>
</body>
</html>
